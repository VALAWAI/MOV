asyncapi: '2.6.0'
info:
 title: Value-Aware Artificial Intelligence API
 version: '0.1.0'
 description: |
  This api provide the messages that the VALAWAI infrastructure cna manage.
  This messages are used to start/stop the infrastructure and for
  mantains the data and control topology.
 license:
  name: MIT
  url: https://opensource.org/license/mit/
 contact:
  name: VALAWAI
  url: https://valawai.eu/
channels:
  valawai/component/register:
    subscribe:
      summary: Used by the components to inform that they are present on the infratructure.
      message:
        $ref: '#/components/messages/register_component'
  valawai/topology/change:
    subscribe:
      summary: Used by the components to inform of the changes that has to be done to the topology.
      message:
        $ref: '#/components/messages/change_topology'

components:
  messages:
    register_component:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/register_component_payload"

    change_topology:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/change_topology_payload"

  schemas:
    register_component_payload:
      description: The information necessary to register a component.
      type: object
      properties:
        type:
          description: The type of component.
          type: string
          enum:
            - 'C0'
            - 'C1'
            - 'C2'
        name:
          description: The component name.
          type: string
          pattern: "c[0|1|2]_\\w+"
          examples: 
            - c0_voice_to_text
            - c2_value_awarness_detector
        version:
          description: the component version.
          type: string
          pattern: "\\d+\\.\\d+\\.\\d+"
          examples: 
            - 1.0.0
            - 1.7.2
        asyncapiYaml:
          description: The asyncapi specification in yaml.
          type: string
          examples: 
            - 'asyncapi: 2.6.0\ninfo:\n  title: Service To test\n  version: 1.5.0\n  description: This service is in charge of processing user signups\nchannels:\n  valawai/test_input:\n    subscribe:\n      message:\n        payload:\n          type: object\n          properties:\n            content:\n              type: string'

    change_topology_payload:
      type: object
      properties:
        action:
          description: The type of action to do on the topology
          enum:
            - 'ENABLE'
            - 'DISABLE'
        connectionId:
          description: The identifier of the topology connection that has changed.
          type: string
          pattern: "[0-9a-fA-F]{24}"
          examples: 
            - "65c1f59ea4cb169f42f5edc4"
